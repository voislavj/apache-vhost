<!DOCTYPE html>
<html>
<head>
    <title>Apache VirtualHost configuration</title>
    <meta charset="utf-8">
    
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/node_modules/lodash/lodash.js"></script>
    <script type="text/javascript" src="/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="/backbone.js"></script>
    
    <script type="text/javascript">
        var host   = location.hostname;
        var port   = location.port;
        var socket = io.connect('http://' + host + ':' + port);
        
        $(function(){
            var Vhost = Backbone.Model.extend({
               defaults: function(){
                   return {
                       "$args":        "*:80",
                       "ServerName":   "",
                       "DocumentRoot": ""
                   }
               }
            });
            
            var VhostsCollection = Backbone.Collection.extend({
                model: Vhost,
                comparator: 'ServerName'
            });
            var Vhosts = new VhostsCollection();
            
	        var VhostView = Backbone.View.extend({
	            tagName:    'li',
	            template:   _.template($('#item-template').html()),
	            
	            initialize: function(){
	                //this.listenTo(this.collection, 'all',  this.render);
	            },
	            
	            render: function(event){
	                this.$el.html(this.template(this.model.attributes));
	                return this;
	            },
	            edit: function() {
	                this.$el.addClass('edit');
	                this.input.focus();
	            },
	            
	            clear: function() {
	                this.model.destroy();
	            }
	        });
	        
	        var VhostsApp = Backbone.View.extend({
	            el: $(document.body),
	            
	            initialize: function() {
	                this.ul = this.$('#vhosts');
	                
	                this.listenTo(Vhosts, 'add', this.add);
	                this.listenTo(Vhosts, 'all', this.render);
	            },
	            
	            add: function(model, collection, options){
	                var item = new VhostView({model: model});
	                this.ul.append(item.render().el);
	            },
	            
	            addAll: function() {
	                Vhosts.each(this.add, this);
	            },
	            
	            render: function(event) {
	                
	            }
	        });
	        
	        socket.on('init', function(vhosts){
	            app = new VhostsApp({
	                collection: Vhosts
	            });
	            Vhosts.add(vhosts);
	        });
        });
    </script>
</head>

<body>
<ul id="vhosts"></ul>
<script type="text/template" id="item-template">
    <h2><%= ServerName %></h2>
</script>
</body>
</html>